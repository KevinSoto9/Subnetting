@page "/"
@using System;
@using System.Linq;
@using System.Globalization;
@using System.Text.RegularExpressions;
@using System.Net;

<html>
  <head>
    <link rel="stylesheet" href="~/css/app.css">
    <title>Calculadora Subnetting (FLSM)</title>
  </head>
  <body>
    <h3>Calculadora Subnetting (FLSM)</h3>
        <table>
            <tbody>
                <tr>
                    <td><label for="ipAddress">IP Address:</label></td>
                    <td colspan="2">
                        <input id="ipAddress" style="width: 405px" type="text" @bind-value="@IPAddress" />
                    @if (!string.IsNullOrEmpty(IPAddress) && !IsValidIpAddress(IPAddress))
                    {
                        <p class="error">Invalid IP Address format</p>
                    }
                    </td>
                </tr>
                <tr>
                    <td><label for="subnetMask">Subnet Mask (CIDR)</label></td>
                    <td colspan="2">
                        <input id="subnetMask" style="width: 405px"  type="text" @bind-value="@SubnetMask" />
                    @if (!string.IsNullOrEmpty(SubnetMask) && !IsValidSubnetMask(SubnetMask))
                    {
                        <p class="error">Invalid Subnet Mask (CIDR) format</p>
                    }
                    </td>
                </tr>
                <tr>
                    <td><label for="numberOfHosts">Numbers of Hosts</label></td>
                    <td colspan="2">
                        <input id="numberOfHosts" style="width: 405px"  type="text" @bind-value="@NumberOfHosts" />
                    </td>
                </tr>
                <tr>
                    <td><label for="numSubnets">Numbers of Subnets</label></td>
                    <td colspan="2">
                        <input id="numSubnets" style="width: 405px"  type="text" @bind-value="@NumSubnets" />
                    </td>
                </tr>
                <tr>
                    <td colspan="3"><button id="boton" type="button" @onclick="CalculateSubnets">Submit</button></td>
                </tr>
            </tbody>
        </table>

        @*@if (Subnets != null)
        {
            <div>
                <h4>Result:</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Size</th>
                            <th>Subnet Mask</th>
                            <th>Address Range</th>
                            <th>Broadcast Address</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var subnet in Subnets)
                        {
                            <tr>
                                <td>@subnet.Name</td>
                                <td>@subnet.Size</td>
                                <td>@subnet.SubnetMask</td>
                                <td>@subnet.AddressRange</td>
                                <td>@subnet.BroadcastAddress</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }*@
  </body>
</html>

@code {
    private string IPAddress;
    private string SubnetMask;
    private string NumberOfHosts;
    private string NumSubnets;
    private List<Subnet> Subnets;

    protected override void OnInitialized()
    {

    }

    private void CalculateSubnets()
    {
        if (!IsValidIpAddress(IPAddress))
        {
            return;
        }

        if (!IsValidSubnetMask(SubnetMask))
        {

            return;
        }

        var numberOfHost = NumberOfHosts;
        var ipAddress = IPAddress;
        var subnetMask = SubnetMask;
        var numsubnets = NumSubnets;
    }

    private bool IsValidIpAddress(string ipAddress)
    {
        string pattern = @"^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$";
        if (!Regex.IsMatch(ipAddress, pattern))
        {
            return false; 
        }

        string[] octets = ipAddress.Split('.');
        foreach (string octet in octets)
        {
            int value = int.Parse(octet);
            if (value < 0 || value > 255)
            {
                return false; 
            }
        }

        return true;
    }

    private bool IsValidSubnetMask(string subnetMask)
    {
        string pattern = @"^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$";
        if (!Regex.IsMatch(subnetMask, pattern))
        {
            return false; 
        }

        string[] octets = subnetMask.Split('.');
        int[] values = new int[4];
        for (int i = 0; i < 4; i++)
        {
            values[i] = int.Parse(octets[i]);
        }

        int firstZero = -1;
        for (int i = 0; i < 4; i++)
        {
            if (values[i] == 0)
            {
                firstZero = i;
                break;
            }
        }

        if (firstZero == -1)
        {
            return false; 
        }

        for (int i = firstZero + 1; i < 4; i++)
        {
            if (values[i] != 0)
            {
                return false; 
            }
        }

        return true;
    }

    public class Subnet
    {
        public string Name { get; set; }
        public string Size { get; set; }
        public string SubnetMask { get; set; }
        public string AddressRange { get; set; }
        public string BroadcastAddress { get; set; }
    }
}